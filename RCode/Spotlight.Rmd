---
title: "Spotlights_pdf"
output:
  html_document: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo =FALSE)
source("./GetINFORM.R")
source("./GetWorldBank.R")


country_full <- "South Sudan"
country_iso <- "SSD"
#Example "SSD"

#Define df for matching numeric class with string class
Rank_class_df<-data.frame(Rank_class = 1:5, Class_levels = as.factor(c("Very Low","Low","Moderate","High","Very High")))
Rank_class_df$Class_levels = factor(Rank_class_df$Class_levels ,levels = c("Very Low","Low","Moderate","High","Very High"))

#INFORM
country_inform <- lapply(Country_with_ranks, function(x) x[x$iso == country_iso,]) %>% #remove the iso column
  do.call(rbind, .) %>%
  {`[`(.[,-1])} %>% #remove column 1, which is the iso3 column
  t  %>%
  data.frame() %>%
  mutate(Index = rownames(.)) %>%
  select(Index, Value, Rank, Rank_class) %>%
  plyr::join(., Rank_class_df, by="Rank_class") %>%
  filter(complete.cases(.))


#WORLD BANK
#Wbank indicator df
country_wbank <- lapply(WB_data_all, function(x) x[x$iso3 == country_iso,]) %>%
  do.call(rbind,.) %>%
  mutate(Indicator = row.names(.)) %>% 
  plyr::join(., Rank_class_df, by="Rank_class") %>%
  select("Indicator", "Value","Year", "Rank", "Rank_class","Class_levels") %>%
  arrange(Indicator)


```

`r toString(country_full)`

##RiX Spotlight for Humanitarian Needs Overview


```{r, echo=FALSE,message=FALSE, out.width="20%"}
library(geodata)
a<-gadm(country_iso, level = 0, path=tempdir())
plot(a, col= "chocolate2", axes=FALSE)

```


```{r Global Indices Table, message=FALSE, warning=FALSE}
source("./Spotlight_plotting_functions.R")
#WORLD BANK
#table -for colored background in table..
country_wbank$Class_levels <-  color_tile2(c("forestgreen",'lightgoldenrod2', "firebrick2"))(country_wbank$Class_levels)
kbl(country_wbank[c(1:4,6)], escape = F) %>%
  kable_paper("striped", full_width = F) %>%
  column_spec(c(4,5), width = c("4cm","3cm"))  %>%
  add_header_above(c("World Bank indicators" = 5))


#INFORM
#indentations sub-types of risks in the index column:
row.ind1 <- which(str_count(country_inform$Index,'\\.') == 1)
row.ind2 <- which(str_count(country_inform$Index,'\\.') == 2)

#table -for colored background in table..
country_inform$Class_levels <-  color_tile2(c("forestgreen",'lightgoldenrod2', "firebrick2"))(country_inform$Class_levels)
kbl(country_inform[c(1,2,5)], escape = F) %>%
  kable_paper("striped", full_width = F) %>%
  column_spec(c(2,3), width = c("4cm","3cm")) %>%
  add_indent(row.ind1 , level_of_indent = 1) %>%
  add_indent(row.ind2 , level_of_indent = 2) %>%
  add_header_above(c("INFORM Risk indicators" = 3), font_size = "medium")


```

