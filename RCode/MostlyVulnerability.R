######################################################################
######################### VULNERABILITY DATA #########################
######################################################################

GetSHDI<-function(ADM,ISO){
  SHDI<-read.csv2(paste0(dir,"/Data/Vulnerability/SHDI-Database.csv"),sep = ";")
  # Keep only the most recent year, sub-national data and the data from the country of interest
  SHDI%<>%group_by(iso_code)%>%filter(year==max(year) & iso_code==ISO & level=="Subnat")%>%
          dplyr::select(c(1,4,6:(ncol(SHDI)-1)))%>%as.data.frame()
  colnames(SHDI)[4:ncol(SHDI)]<-c("SHDI","HealthI","LivingStandI","EducationI","LifeExp","GrossNatInc","ExpectedSchoolYrs","MeanSchoolYrs")
  # Convert to numeric
  for(i in 4:ncol(SHDI)) SHDI[,i]<-as.numeric(SHDI[,i])
  # We don't want the log of the Gross National Income
  SHDI$GrossNatInc%<>%exp()
  # Get the polygon shapefile of the admin boundaries of the SHDI database
  SHDIpoly<-GetSHDIadmin(ISO)
  # Find which indices in the SHDI object correspond to ADM values
  indies<-Poly2poly(SHDIpoly,ADM)
  # Bind the ADM data.frame with the GDL values
  ADM$GDLCODE<-indies%>%arrange(indexADM)%>%pull(GDLCODE)
  ADM@data%<>%merge(dplyr::select(SHDI,-iso_code),by="GDLCODE")
  
  return(ADM)
}
